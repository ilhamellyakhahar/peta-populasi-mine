<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regional Population Map - Jasmine</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        #map { height: 550px; border-radius: 10px; }
        .note-box {
            background: #f8f9fa;
            border-left: 5px solid #007bff;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 0.95rem;
        }
        .leaflet-tooltip.custom-tooltip {
            background-color: white;
            color: black;
            border-radius: 8px;
            padding: 5px 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            font-size: 0.9rem;
        }
    </style>
</head>
<body class="container py-4">

    <header class="mb-4 text-center">
        <h1 class="fw-bold text-primary">Regional Population Map in West Java üó∫Ô∏è</h1>
        <p class="text-muted">Use the filter below to display data according to population criteria or city name.</p>
    </header>

    <!-- Filter Form -->
    <form action="/" method="POST" class="row g-3 mb-4">
        <div class="col-md-4">
            <label for="min_pop" class="form-label">Minimum Population</label>
            <input type="number" id="min_pop" name="min_pop" class="form-control" value="{{ min_pop }}">
        </div>
        <div class="col-md-4">
            <label for="keyword" class="form-label">City Name Contains</label>
            <input type="text" id="keyword" name="keyword" class="form-control" value="{{ keyword }}">
        </div>
        <div class="col-md-4 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">Display Data</button>
        </div>
    </form>

    <!-- Small note -->
    <div class="note-box mb-4">
        üí° <strong>Note:</strong> Enter minimum population to filter cities based on population count.  
        For example, enter <em>2000000</em> to display cities with population above two million.
    </div>

    <!-- Map -->
    <div class="card">
        <div class="card-body">
            <div id="map"></div>
        </div>
    </div>

    <footer class="text-center text-muted mt-4">
        ¬© 2025 Indonesian Population WebGIS | Simulation data
    </footer>

    <!-- Leaflet Script -->
    <script>
        var map = L.map('map').setView([-6.8, 107.2], 8);

        // Base map
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // Data from Flask (CSV)
        var dataPopulasi = {{ data | tojson }};

        // Color function based on population
        function getColor(pop) {
            if (pop > 2500000) return "#e63946"; // dark red
            else if (pop > 1500000) return "#f4a261"; // orange
            else if (pop > 800000) return "#f6bd60"; // yellow
            else if (pop > 400000) return "#90be6d"; // light green
            else return "#43aa8b"; // dark green
        }

        // Add markers to map
        dataPopulasi.forEach(function(kota) {
            var warna = getColor(kota.populasi);

            var circle = L.circleMarker([kota.lat, kota.lon], {
                radius: 10,
                fillColor: warna,
                color: "#555",
                weight: 1,
                opacity: 1,
                fillOpacity: 0.9
            }).addTo(map);

            var popup = `
                <div style="text-align:center">
                    <b>${kota.nama}</b><br>
                    üë• Population: ${kota.populasi.toLocaleString()} people
                </div>
            `;
            circle.bindTooltip(popup, {
                permanent: false,
                direction: 'top',
                className: 'custom-tooltip'
            });
        });
    </script>

</body>
</html>
